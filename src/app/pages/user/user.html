<section class="page">
  <!-- Topbar -->
  <header class="topbar">
    <div class="left">
      <h1>Dashboard</h1>
      <p class="muted">Bem-vindo(a) à central de chamados.</p>
    </div>
    <div class="right">
      <button class="btn" (click)="toKnowledge()">Base de conhecimento</button>
      <button class="btn btn--primary" (click)="toNewTicket()">Abrir chamado</button>
      <button class="btn btn--danger" (click)="logout()">Sair</button>
    </div>
  </header>

  @if (loading()) {
    <div class="state muted">Carregando…</div>
  } @else if (error()) {
    <div class="state error">{{ error() }}</div>
  } @else {
    @if (currentUser) {
      <section class="welcome">
        <div class="avatar-circle">{{ (currentUser.name || 'U')[0] }}</div>
        <div class="who">
          <h2>Olá, {{ currentUser.name }}</h2>
          <p class="muted">{{ currentUser.email }}</p>
        </div>
        <button class="btn" (click)="toProfile()">Meu perfil</button>
      </section>
    }

    <!-- KPIs -->
    <section class="cards">
      <article class="card" (click)="toTickets()">
        <div class="card__title">Meus abertos</div>
        <div class="card__value">{{ myOpenCount }}</div>
      </article>
      <article class="card" (click)="toTickets()">
        <div class="card__title">Atribuídos a mim</div>
        <div class="card__value">{{ assignedToMeCount }}</div>
      </article>
      <article class="card" (click)="toTickets()">
        <div class="card__title">Em andamento</div>
        <div class="card__value">{{ inProgressCount }}</div>
      </article>
      <article class="card" (click)="toTickets()">
        <div class="card__title">Resolvidos (30d)</div>
        <div class="card__value">{{ resolved30dCount }}</div>
      </article>
    </section>
  }
</section>
